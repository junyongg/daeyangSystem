<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="schedule"> 

	
	<!-- 일마다 합쳐서 넣기 (인버터) --> 
	<insert id="InverterInsertDay">
	 	INSERT INTO INVERTER (
	 		IO_POWER , IO_USAGE , IO_CHARGE ,IO_STATUS ,IO_DATE ,IO_TYPE, IO_CO2 , IO_CASH	
	 	)
	 	SELECT (SELECT PSD_VALUE FROM PCS_SOLAR_DATA WHERE DAY(PSD_DATE) = DAY(date_add(now(), INTERVAL -1 DAY)) ORDER BY PSD_KEYNO DESC LIMIT 1),  
			   (SELECT Total_Wh FROM DISTRIBUTION_BOARD WHERE DAY(Date_time) = DAY(date_add(now(), INTERVAL -1 DAY)) ORDER BY iddaekyung_dc DESC LIMIT 1),  
			   (SELECT IO_CHARGE FROM INVERTER WHERE DAY(IO_DATE) = DAY(date_add(now(), INTERVAL -1 DAY)) ORDER BY IO_KEYNO DESC LIMIT 1) AS IO_CHARGE,
			   (SELECT IO_STATUS FROM INVERTER WHERE DAY(IO_DATE) = DAY(date_add(now(), INTERVAL -1 DAY)) ORDER BY IO_KEYNO DESC LIMIT 1) AS IO_STATUS,
			   (SELECT IO_DATE FROM INVERTER WHERE DAY(IO_DATE) = DAY(date_add(now(), INTERVAL -1 DAY)) ORDER BY IO_DATE DESC LIMIT 1) AS IO_DATE,
			   IO_TYPE ,
			   MAX(IO_CO2) ,
			   MAX(IO_CASH) 
		FROM INVERTER
		WHERE DAY(IO_DATE) = DAY(date_add(now(), INTERVAL -1 DAY))
	</insert>
	
	<!-- 일마다 삭제 (인버터) -->
	<delete id="InverterDeleteDay">
		DELETE
		FROM INVERTER
		WHERE DAY(IO_DATE) = DAY(date_add(now(), INTERVAL -1 DAY))
		AND IO_KEYNO != (	
			SELECT IO_KEYNO 
			FROM INVERTER
			WHERE DAY(IO_DATE) = DAY(date_add(now(), INTERVAL -1 DAY))
			ORDER BY IO_KEYNO  DESC
			LIMIT 1
		)
	</delete>
	
	
	<!-- 일마다 합쳐서 넣기(PCS 발전데이터) --> 
	<insert id="PcsInsertDay">
	 	INSERT INTO PCS_SOLAR_DATA (
	 		PSD_VALUE , PSD_DATE	
	 	)
	 	SELECT PSD_VALUE  ,PSD_DATE
		FROM PCS_SOLAR_DATA
		WHERE DAY(PSD_DATE) = DAY(date_add(now(), INTERVAL -1 DAY))
		ORDER BY PSD_KEYNO DESC 
		LIMIT 1
	</insert>
	
	<!-- 일마다 삭제(PCS 발전데이터) -->
	<delete id="PcsDeleteDay">
		DELETE
		FROM PCS_SOLAR_DATA
		WHERE DAY(PSD_DATE) = DAY(date_add(now(), INTERVAL -1 DAY))
		AND PSD_KEYNO != (	
			SELECT PSD_KEYNO 
			FROM PCS_SOLAR_DATA
			WHERE DAY(PSD_DATE) = DAY(date_add(now(), INTERVAL -1 DAY))
			ORDER BY PSD_KEYNO  DESC
			LIMIT 1
		)
	</delete>
	
	
	<!-- 일마다 합쳐서 넣기(분전반 데이터) --> 
	<insert id="LvcdInsertDay">
	 	INSERT INTO DISTRIBUTION_BOARD (
	 		Date_time ,Total_V ,Total_A , Total_P ,Total_Wh, Total_RWh , Ch1_V , Ch1_A, Ch1_P, Ch1_Wh , Ch1_RWh ,Ch2_V, `Ch2_ A`, Ch2_P, Ch2_Wh, Ch2_RWh, Ch3_V , Ch3_A, Ch3_P, Ch3_Wh, Ch3_RWh, Ch4_V, Ch4_A, Ch4_P, Ch4_Wh, Ch4_RWh, Ch5_V ,Ch5_A ,Ch5_P, Ch5_Wh, Ch5_RWh , Ch6_V ,Ch6_A, Ch6_P, Ch6_Wh, Ch6_RWh , Ch7_V ,Ch7_A, Ch7_P, Ch7_Wh, Ch7_RWh , Ch8_V ,Ch8_A, Ch8_P, Ch8_Wh, Ch8_RWh , Ch9_V ,Ch9_A, Ch9_P, Ch9_Wh, Ch9_RWh , Ch10_V ,Ch10_A, Ch10_P, Ch10_Wh, Ch10_RWh , Ch11_V ,Ch11_A, Ch11_P, Ch11_Wh, Ch11_RWh , Ch12_V ,Ch12_A, Ch12_P, Ch12_Wh, Ch12_RWh ,Ch1_MOT ,Ch2_MOT ,Ch3_MOT ,Ch4_MOT ,Ch5_MOT ,Ch6_MOT ,Ch7_MOT ,Ch8_MOT ,Ch9_MOT ,Ch10_MOT ,Ch11_MOT ,Ch12_MOT                                                              
	 	)
	 	SELECT Date_time ,Total_V ,Total_A , Total_P ,Total_Wh, Total_RWh , Ch1_V , Ch1_A, Ch1_P, Ch1_Wh , Ch1_RWh ,Ch2_V, `Ch2_ A`, Ch2_P, Ch2_Wh, Ch2_RWh, Ch3_V ,Ch3_A, Ch3_P, Ch3_Wh, Ch3_RWh, Ch4_V, Ch4_A, Ch4_P, Ch4_Wh, Ch4_RWh, Ch5_V ,Ch5_A ,Ch5_P, Ch5_Wh, Ch5_RWh , Ch6_V ,Ch6_A, Ch6_P, Ch6_Wh, Ch6_RWh , Ch7_V ,Ch7_A, Ch7_P, Ch7_Wh, Ch7_RWh , Ch8_V ,Ch8_A, Ch8_P, Ch8_Wh, Ch8_RWh , Ch9_V ,Ch9_A, Ch9_P, Ch9_Wh, Ch9_RWh , Ch10_V ,Ch10_A, Ch10_P, Ch10_Wh, Ch10_RWh , Ch11_V ,Ch11_A, Ch11_P, Ch11_Wh, Ch11_RWh , Ch12_V ,Ch12_A, Ch12_P, Ch12_Wh, Ch12_RWh ,Ch1_MOT ,Ch2_MOT ,Ch3_MOT ,Ch4_MOT ,Ch5_MOT ,Ch6_MOT ,Ch7_MOT ,Ch8_MOT ,Ch9_MOT ,Ch10_MOT ,Ch11_MOT ,Ch12_MOT   
		FROM DISTRIBUTION_BOARD
		WHERE DAY(Date_time) = DAY(date_add(now(), INTERVAL -1 DAY))
		ORDER BY iddaekyung_dc DESC 
		LIMIT 1
	</insert>
	
	<!-- 일마다 삭제(분전반 데이터) -->
	<delete id="LvcdDeleteDay">
		DELETE
		FROM DISTRIBUTION_BOARD
		WHERE DAY(Date_time) = DAY(date_add(now(), INTERVAL -1 DAY))
		AND iddaekyung_dc != (	
			SELECT iddaekyung_dc
			FROM DISTRIBUTION_BOARD
			WHERE DAY(Date_time) = DAY(date_add(now(), INTERVAL -1 DAY))
			ORDER BY iddaekyung_dc DESC 
			LIMIT 1
		)
	</delete>
	
	<!-- 일마다 삭제(ems 데이터) -->
	<delete id="EmsDeleteDay">
		DELETE
		FROM EMS
		WHERE DAY(time) = DAY(date_add(now(), INTERVAL -1 DAY))
		AND EMS_KEYNO != (	
			SELECT EMS_KEYNO
			FROM EMS
			WHERE DAY(time) = DAY(date_add(now(), INTERVAL -1 DAY))
			ORDER BY EMS_KEYNO DESC 
			LIMIT 1
		)
	</delete>
	
	
	
	
	<insert id="TestRandomPCS" parameterType="HashMap">
		INSERT INTO PCS_SOLAR_DATA
		(
			PSD_VALUE
		)
		VALUES(
			#{PSD_VALUE}
		)
	</insert>
	
	<insert id="TestRandomLVDC" parameterType="SerialDTO">
	 	INSERT INTO DISTRIBUTION_BOARD (
	 		Date_time ,Total_V ,Total_A , Total_P ,Total_Wh, Total_RWh , Ch1_V , Ch1_A, Ch1_P, Ch1_Wh , Ch1_RWh ,Ch2_V, `Ch2_ A`, Ch2_P, Ch2_Wh, Ch2_RWh, Ch3_V , Ch3_A, Ch3_P, Ch3_Wh, Ch3_RWh, Ch4_V, Ch4_A, Ch4_P, Ch4_Wh, Ch4_RWh, Ch5_V ,Ch5_A ,Ch5_P, Ch5_Wh, Ch5_RWh , Ch6_V ,Ch6_A, Ch6_P, Ch6_Wh, Ch6_RWh , Ch7_V ,Ch7_A, Ch7_P, Ch7_Wh, Ch7_RWh , Ch8_V ,Ch8_A, Ch8_P, Ch8_Wh, Ch8_RWh , Ch9_V ,Ch9_A, Ch9_P, Ch9_Wh, Ch9_RWh , Ch10_V ,Ch10_A, Ch10_P, Ch10_Wh, Ch10_RWh , Ch11_V ,Ch11_A, Ch11_P, Ch11_Wh, Ch11_RWh , Ch12_V ,Ch12_A, Ch12_P, Ch12_Wh, Ch12_RWh ,Ch1_MOT ,Ch2_MOT ,Ch3_MOT ,Ch4_MOT ,Ch5_MOT ,Ch6_MOT ,Ch7_MOT ,Ch8_MOT ,Ch9_MOT ,Ch10_MOT ,Ch11_MOT ,Ch12_MOT                                                              
	 	)VALUES(
	 		#{Date_time} ,#{Total_V} ,#{Total_A}, #{Total_P} ,#{Total_Wh}, #{Total_RWh} , #{Ch1_V} , #{Ch1_A}, #{Ch1_P}, #{Ch1_Wh} , #{Ch1_RWh} ,#{Ch2_V}, #{Ch2_A}, #{Ch2_P}, #{Ch2_Wh}, #{Ch2_RWh}, #{Ch3_V} , #{Ch3_A}, #{Ch3_P}, #{Ch3_Wh}, #{Ch3_RWh}, #{Ch4_V}, #{Ch4_A}, #{Ch4_P}, #{Ch4_Wh}, #{Ch4_RWh}, #{Ch5_V} ,#{Ch5_A} ,#{Ch5_P}, #{Ch5_Wh}, #{Ch5_RWh} , #{Ch6_V} ,#{Ch6_A}, #{Ch6_P}, #{Ch6_Wh}, #{Ch6_RWh} , #{Ch7_V} ,#{Ch7_A}, #{Ch7_P}, #{Ch7_Wh}, #{Ch7_RWh} , #{Ch8_V} ,#{Ch8_A}, #{Ch8_P}, #{Ch8_Wh}, #{Ch8_RWh} , #{Ch9_V} ,#{Ch9_A}, #{Ch9_P}, #{Ch9_Wh}, #{Ch9_RWh} , #{Ch10_V} ,#{Ch10_A}, #{Ch10_P}, #{Ch10_Wh}, #{Ch10_RWh} , #{Ch11_V},#{Ch11_A}, #{Ch11_P}, #{Ch11_Wh}, #{Ch11_RWh} , #{Ch12_V} ,#{Ch12_A}, #{Ch12_P}, #{Ch12_Wh}, #{Ch12_RWh} ,#{Ch1_MOT} ,#{Ch2_MOT} ,#{Ch3_MOT} ,#{Ch4_MOT} ,#{Ch5_MOT} ,#{Ch6_MOT} ,#{Ch7_MOT} ,#{Ch8_MOT} ,#{Ch9_MOT} ,#{Ch10_MOT} ,#{Ch11_MOT} ,#{Ch12_MOT}
	 	)
	</insert>
	
</mapper>