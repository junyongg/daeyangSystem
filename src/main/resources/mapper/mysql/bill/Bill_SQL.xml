<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bills">
	
		<select id="billsSelect" resultType="hashmap" >
			SELECT * 
			FROM dy_bills_provider
		</select>

		<select id="billsSelect_one" resultType="hashmap" parameterType="String">
			SELECT * 
			FROM dy_bills_provider
			WHERE dbp_keyno = #{dbp_keyno}
		</select>
		
		
		<insert id="billsProvideInsert" parameterType="billDTO">
			INSERT INTO dy_bills_provider
			(
				dbp_id,
				dbp_pass,
				dbp_apikey,
				dbp_co_num,
				dbp_biztype,
				dbp_name,
				dbp_bizclassification,
				dbp_ceoname,
				dbp_busename,
				dbp_ir_name,
				dbp_ir_cell,
				dbp_email,
				dbp_address
			)VALUES(
				#{hometaxbill_id},
				#{spass},
				#{apikey},
				#{ir_companynumber},
				#{ir_biztype},
				#{ir_companyname},
				#{ir_bizclassification},
				#{ir_ceoname},
				#{ir_busename},
				#{ir_name},
				#{ir_cell},
				#{ir_email},
				#{ir_companyaddress}
			)
		</insert>
		
		<update id="billsProvideUPdate" parameterType="billDTO">
			UPDATE dy_bills_provider 
			SET dbp_id = #{hometaxbill_id},
				dbp_pass = #{spass},
				dbp_apikey = #{apikey},
				dbp_co_num = #{ir_companynumber},
				dbp_biztype = #{ir_biztype},
				dbp_name = #{ir_companyname},
				dbp_bizclassification = #{ir_bizclassification},
				dbp_ceoname = #{ir_ceoname},
				dbp_busename = #{ir_busename},
				dbp_ir_name = #{ir_name},
				dbp_ir_cell = #{ir_cell},
				dbp_email = #{ir_email},
				dbp_address = #{ir_companyaddress}
			WHERE dbp_keyno = #{dbp_keyno}
		</update>
		
		<update id="registNumberUpdate" parameterType="billDTO">
		UPDATE dy_bills_provider 
		SET dbp_homemunseo_id = #{homemunseo_id}
		WHERE dbp_keyno = #{dbp_keyno}
	</update>	
		
		<!-- 사업등록번호 카운팅 -->
		<select id="billCount" resultType="int" parameterType="billDTO">
			SELECT COUNT(*) FROM dy_bills_provider WHERE dbp_co_num = #{ir_companynumber}
		</select>

		<select id="SuppliedSelect" resultType="hashmap">
			SELECT *
			FROM dy_bills_supplied
		</select>
		<select id="SuppliedSelect_one" resultType="hashmap" parameterType="String">
			SELECT * 
			FROM dy_bills_supplied
			WHERE dbs_keyno = #{dbs_keyno}
		</select>
	
	
		<insert id="billsProvideInsert2" parameterType="billDTO">
		INSERT INTO dy_bills_supplied
		(
			dbs_co_num,
			dbs_biztype ,
			dbs_name,
			dbs_bizclassification,
			dbs_taxnum,
			dbs_ceoname,
			dbs_busename1,
			dbs_name1,
			dbs_cell1,
			dbs_email1,
			dbs_busename2,
			dbs_name2,
			dbs_cell2,
			dbs_email2,
			dbs_address
		)VALUES(
			#{ie_companynumber},
			#{ie_biztype},
			#{ie_companyname},
			#{ie_bizclassification},
			#{ie_taxnumber},
			#{ie_ceoname},
			#{ie_busename1},
			#{ie_name1},
			#{ie_cell1},
			#{ie_email1},
			#{ie_busename2},
			#{ie_name2},
			#{ie_cell2},
			#{ie_email2},
			#{ie_companyaddress}
		)
	</insert>
	
	<update id="billsProvideUPdate2" parameterType="billDTO">
		UPDATE dy_bills_supplied 
		SET dbs_co_num = #{ie_companynumber},
			dbs_biztype = #{ie_biztype},
			dbs_name = #{ie_companyname},
			dbs_bizclassification = #{ie_bizclassification},
			dbs_taxnum = #{ie_taxnumber},
			dbs_ceoname = #{ie_ceoname},
			dbs_busename1 = #{ie_busename1},
			dbs_name1 = #{ie_name1},
			dbs_cell1 = #{ie_cell1},
			dbs_email1 = #{ie_email1},
			dbs_busename2 = #{ie_busename2},
			dbs_name2 = #{ie_name2},
			dbs_cell2 = #{ie_cell2},
			dbs_email2 = #{ie_email2},
			dbs_address = #{ie_companyaddress}
		WHERE dbs_keyno = #{dbs_keyno}
	</update>
	
	<!-- 사업등록번호 카운팅 공급받는자 -->
	<select id="billCount2" resultType="int" parameterType="billDTO">
		SELECT COUNT(*) FROM dy_bills_supplied WHERE dbs_co_num = #{ie_companynumber}
	</select>
	
	<insert id="billsInfoInsert" parameterType="String">
			INSERT INTO dy_bills_log
			(
				dbl_provider_key,
				dbl_supplied_key,
				dbl_cash,
				dbl_scheck,
				dbl_draft,
				dbl_uncollected,
				dbl_chargetotal,
				dbl_taxtotal,
				dbl_grandtotal,
				dbl_subject,
				dbl_unit,
				dbl_quantity,
				dbl_unitprice,
				dbl_supplyprice,
				dbl_tax,
				dbl_description,
				dbl_p_name,
				dbl_s_name,
				dbl_purposetype,
				dbl_partytypecode,
				dbl_issueid,
				dbl_typecode1,
				dbl_typecode2,
				dbl_sub_description,
				dbl_issuedate,
				dbl_sub_issuedate,
				dbl_sub_keyno
			)VALUES(
				#{dbp_keyno},
				#{dbs_keyno},
				#{cash},
				#{scheck},
				#{draft},
				#{uncollected},
				#{chargetotal},
				#{taxtotal},
				#{grandtotal},
				#{subject},
				#{unit},
				#{quantity},
				#{unitprice},
				#{supplyprice},
				#{tax},
				#{description},
				#{ir_companyname},
				#{ie_companyname},
				#{purposetype},
				#{partytypecode},
				#{issueid},
				#{typecode1},
				#{typecode2},
				#{sub_description},
				#{issuedate},
				#{sub_issuedate},
				#{dbl_sub_keyno}
			)
	</insert>
	
	<update id="billsInfoUpdate" parameterType="billDTO">
		UPDATE dy_bills_log
		SET dbl_provider_key = #{dbp_keyno},
			dbl_supplied_key = #{dbs_keyno},
			dbl_cash = #{cash},
			dbl_scheck = #{scheck},
			dbl_draft = #{draft},
			dbl_uncollected = #{uncollected},
			dbl_chargetotal = #{chargetotal},
			dbl_taxtotal = #{taxtotal},
			dbl_grandtotal = #{grandtotal},
			dbl_subject = #{subject},
			dbl_unit = #{unit},
			dbl_quantity = #{quantity},
			dbl_unitprice = #{unitprice},
			dbl_supplyprice = #{supplyprice},
			dbl_tax = #{tax},
			dbl_description = #{description},
			dbl_p_name = #{ir_companyname},
			dbl_s_name = #{ie_companyname},
			dbl_purposetype = #{purposetype},
			dbl_partytypecode = #{partytypecode},
			dbl_sub_description = #{sub_description},
			dbl_issuedate = #{issuedate},
			dbl_sub_issuedate = #{sub_issuedate}
		WHERE dbl_keyno = #{dbl_keyno}
	</update>
	
	<select id="billslogselect" resultType="hashmap" >
			SELECT * 
			FROM dy_bills_log
			
	</select>
	
	<select id="selectAllView" parameterType="billDTO" resultType="billDTO">
			SELECT * 
			FROM dy_bills_log l
			left join dy_bills_provider p
			on l.dbl_provider_key = p.dbp_keyno
			left join dy_bills_supplied s
			on l.dbl_supplied_key = s.dbs_keyno
			where l.dbl_keyno = #{dbl_keyno}

	</select>
	<delete id="billsDelete" parameterType="arraylist">
			DELETE  FROM dy_bills_log 
			where
			<foreach item = "l" index="index" collection="array" open="(" close=")" separator="or">
			dbl_keyno = #{l}
			</foreach>
	</delete>
</mapper>
 