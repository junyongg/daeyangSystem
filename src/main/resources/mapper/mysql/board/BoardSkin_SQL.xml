<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="BoardSkin">
	
	 <sql id="BST_getListBody">
		FROM(
			SELECT 	  BST_KEYNO
					, @rownum:=@rownum+1 as COUNT
		    		, LEFT(BST_REGDT,10) BST_REGDT
		    		, IFNULL(U.UI_REP_NAME,BST_REGNM) BST_UI_NAME
		    		, BST_TITLE
		    		, CASE 
		    			WHEN B.BST_TYPE  = 'list' THEN '리스트'
		    			WHEN B.BST_TYPE = 'detail' THEN '상세'
		    			WHEN B.BST_TYPE = 'insert' THEN '등록'
		    			END BST_TYPE_NAME
		    FROM	B_BOARD_SKIN_TEMPLATE B  
		    LEFT JOIN U_USERINFO U
		    ON		B.BST_REGNM	=	U.UI_KEYNO
		    ,(SELECT @rownum:=0)TMP
			WHERE BST_DElETE = 'N'
		)AA
		WHERE 1=1
		<if test="searchList != null">
	 	<foreach collection="searchList" item="item">
	 		<choose>
	 			<when test='item.searchIndex.equals("1")'>
 		AND		COUNT 			LIKE CONCAT('%',#{item.searchKeyword},'%')					
	 			</when>
	 			<when test='item.searchIndex.equals("2")'>
 		AND		BST_TYPE_NAME					LIKE CONCAT('%',#{item.searchKeyword},'%')						
	 			</when>
	 			<when test='item.searchIndex.equals("3")'>
 		AND		BST_TITLE					LIKE CONCAT('%',#{item.searchKeyword},'%')						
	 			</when>
	 			<when test='item.searchIndex.equals("4")'>
 		AND		BST_UI_NAME 	LIKE CONCAT('%',#{item.searchKeyword},'%')						
	 			</when>
	 			<when test='item.searchIndex.equals("5")'>
 		AND		BST_REGDT 		LIKE CONCAT('%',#{item.searchKeyword},'%')						
	 			</when>
	 			<when test='item.searchIndex.equals("all")'>
 		AND (
 				COUNT 			LIKE CONCAT('%',#{item.searchKeyword},'%') 				OR
 				BST_TYPE_NAME 			LIKE CONCAT('%',#{item.searchKeyword},'%') 				OR
 				BST_TITLE 			LIKE CONCAT('%',#{item.searchKeyword},'%') 				OR
 				BST_UI_NAME 	LIKE CONCAT('%',#{item.searchKeyword},'%')  		OR
 				BST_REGDT 		LIKE CONCAT('%',#{item.searchKeyword},'%')						
 		)							
	 			</when>
	 		</choose>
	 	</foreach>
	 	</if>
	</sql>

	<select id="BST_getListCnt" resultType="int">
			SELECT	COUNT(*)
		<include  refid="BST_getListBody"/>
    </select>
    
    
    <select id="BST_getList" resultMap="ResultMap.rownumHashMap">
		SELECT	*
		<include  refid="BST_getListBody"/>
		<choose>
	 		<when test="orderBy == 1">
	 		ORDER BY	COUNT ${sortDirect}
	 		</when>
	 		<when test="orderBy == 2">
	 		ORDER BY	BST_TYPE_NAME ${sortDirect}
	 		</when>
	 		<when test="orderBy == 3">
	 		ORDER BY	BST_TITLE ${sortDirect}
	 		</when>
	 		<when test="orderBy == 4">
	 		ORDER BY	BST_UI_NAME ${sortDirect}
	 		</when>
	 		<when test="orderBy == 5">
	 		ORDER BY	BST_REGDT ${sortDirect}
	 		</when>
	 		<otherwise>
	 		ORDER BY BST_KEYNO DESC
	 		</otherwise>
	 	</choose>
		<if test="recordCountPerPage != 0">
		 	LIMIT  	#{recordCountPerPage} OFFSET #{firstIndex}
		</if> 	
    </select>

	<select id="BST_getData" resultType="BoardSkin">
		SELECT *
		FROM B_BOARD_SKIN_TEMPLATE
		WHERE 1 = 1 
		AND BST_DELETE = 'N'		
		<if test="BST_KEYNO != null and BST_KEYNO !=''">
			AND BST_KEYNO = #{BST_KEYNO}
		</if>
		
	</select>
	
	<select id="BST_FormList" resultType="BoardSkin">
		SELECT BST_TITLE, BST_KEYNO, BST_FORM ,BST_TYPE
		FROM B_BOARD_SKIN_TEMPLATE
		WHERE BST_DELETE = 'N'
		<if test="BST_TYPE != null and BST_TYPE != ''">
			AND BST_TYPE = #{BST_TYPE}
		</if>
	</select>
	
	<insert id="BST_insert"> 
		INSERT INTO B_BOARD_SKIN_TEMPLATE
		(
			BST_TITLE,
			BST_FORM,
			BST_REGDT,
			BST_REGNM,
			BST_TYPE
		)VALUES(
			#{BST_TITLE},
			#{BST_FORM},
			SYSDATE(),
			#{BST_REGNM},
			#{BST_TYPE}
		)
	</insert>
	
	<update id="BST_update">
	UPDATE B_BOARD_SKIN_TEMPLATE
	SET 
		BST_TITLE = #{BST_TITLE},
		BST_FORM = #{BST_FORM},
		BST_TYPE = #{BST_TYPE}
	WHERE BST_KEYNO  = #{BST_KEYNO}
	</update>

	<update id="BST_delete">
	UPDATE B_BOARD_SKIN_TEMPLATE
	SET 
		BST_DELETE = 'Y'
	WHERE BST_KEYNO  = #{BST_KEYNO}
	</update>
	
	
	<!-- 패키지 관리 sql -->
	
	 <sql id="BSP_getListBody">
		FROM(
			SELECT 	  BSP_KEYNO
					, @rownum:=@rownum+1 as COUNT
		    		, LEFT(BSP_REGDT,10) BSP_REGDT
		    		, IFNULL(U.UI_REP_NAME,BSP_REGNM) BSP_UI_NAME
		    		, BSP_TITLE
		    		, CASE 
		    			WHEN B.BSP_LIST_KEYNO = 'list' then '기본 리스트 폼'  
		    			WHEN B.BSP_LIST_KEYNO = 'no_detail' then '상세페이지 없는 리스트 폼'  
		    			WHEN B.BSP_LIST_KEYNO = 'gallery' then '갤러리 폼'  
		    			WHEN B.BSP_LIST_KEYNO = 'calendar' then '캘린더 폼' 
		    			ELSE  (SELECT BST_TITLE FROM B_BOARD_SKIN_TEMPLATE WHERE BST_KEYNO = B.BSP_LIST_KEYNO ) 
		    			END LIST_TITLE
		    		, CASE 
		    			WHEN B.BSP_DETAIL_KEYNO = 'no' then '사용안함'  
		    			WHEN B.BSP_DETAIL_KEYNO = 'normal' then '기본 상세페이지 폼'  
		    			ELSE  (SELECT BST_TITLE FROM B_BOARD_SKIN_TEMPLATE WHERE BST_KEYNO = B.BSP_DETAIL_KEYNO )
		    			END DETAIL_TITLE
		    		, CASE 
		    			WHEN B.BSP_INSERT_KEYNO = 'normal' then '기본 등록 폼'  
		    			ELSE  (SELECT BST_TITLE FROM B_BOARD_SKIN_TEMPLATE WHERE BST_KEYNO = B.BSP_INSERT_KEYNO )
		    			END INSERT_TITLE
		    FROM	B_BOARD_SKIN_PACKAGE B  
		    LEFT JOIN U_USERINFO U
		    ON		B.BSP_REGNM	=	U.UI_KEYNO
		    		,(SELECT @rownum:=0)TMP
			WHERE BSP_DElETE = 'N'
		)AA
		WHERE 1=1
		<if test="searchList != null">
	 	<foreach collection="searchList" item="item">
	 		<choose>
	 			<when test='item.searchIndex.equals("1")'>
 		AND		COUNT 			LIKE CONCAT('%',#{item.searchKeyword},'%')					
	 			</when>
	 			<when test='item.searchIndex.equals("2")'>
 		AND		BSP_TITLE		LIKE CONCAT('%',#{item.searchKeyword},'%')						
	 			</when>
	 			<when test='item.searchIndex.equals("3")'>
 		AND		LIST_TITLE 	LIKE CONCAT('%',#{item.searchKeyword},'%')						
	 			</when>
	 			<when test='item.searchIndex.equals("4")'>
 		AND		DETAIL_TITLE 		LIKE CONCAT('%',#{item.searchKeyword},'%')						
	 			</when>
	 			<when test='item.searchIndex.equals("5")'>
 		AND		INSERT_TITLE 		LIKE CONCAT('%',#{item.searchKeyword},'%')						
	 			</when>
	 			<when test='item.searchIndex.equals("all")'>
 		AND (
 				COUNT 			LIKE CONCAT('%',#{item.searchKeyword},'%') 		OR
 				BSP_TITLE 			LIKE CONCAT('%',#{item.searchKeyword},'%') 	OR
 				LIST_TITLE 	LIKE CONCAT('%',#{item.searchKeyword},'%')  		OR
 				DETAIL_TITLE 		LIKE CONCAT('%',#{item.searchKeyword},'%')	 OR					
 				INSERT_TITLE 		LIKE CONCAT('%',#{item.searchKeyword},'%')						
 		)							
	 			</when>
	 		</choose>
	 	</foreach>
	 	</if>
	</sql>
	
	
	<select id="BSP_getListCnt" resultType="int">
			SELECT	COUNT(*)
		<include  refid="BSP_getListBody"/>
    </select>
    
    
    <select id="BSP_getList" resultMap="ResultMap.rownumHashMap">
		SELECT	*
		<include  refid="BSP_getListBody"/>
		<choose>
	 		<when test="orderBy == 1">
	 		ORDER BY	COUNT ${sortDirect}
	 		</when>
	 		<when test="orderBy == 2">
	 		ORDER BY	BSP_TITLE ${sortDirect}
	 		</when>
	 		<when test="orderBy == 3">
	 		ORDER BY	LIST_TITLE ${sortDirect}
	 		</when>
	 		<when test="orderBy == 4">
	 		ORDER BY	DETAIL_TITLE ${sortDirect}
	 		</when>
	 		<when test="orderBy == 4">
	 		ORDER BY	INSERT_TITLE ${sortDirect}
	 		</when>
	 		<otherwise>
	 		ORDER BY BSP_KEYNO DESC
	 		</otherwise>
	 	</choose>
		<if test="recordCountPerPage != 0">
		 	LIMIT  	#{recordCountPerPage} OFFSET #{firstIndex}
		</if> 	
    </select>
	
	<select id="BSP_getData" resultType="BoardSkin">
		SELECT *
		FROM B_BOARD_SKIN_PACKAGE
		WHERE BSP_KEYNO = #{BSP_KEYNO}
	</select>
	
	<select id="BSP_getData_WithForm" resultType="BoardSkin">
		SELECT *
		, (SELECT BST_FORM FROM B_BOARD_SKIN_TEMPLATE WHERE BST_KEYNO = BSP_LIST_KEYNO) as BSP_LIST_FORM
		, (SELECT BST_FORM FROM B_BOARD_SKIN_TEMPLATE WHERE BST_KEYNO = BSP_DETAIL_KEYNO) as BSP_DETAIL_FORM
		, (SELECT BST_FORM FROM B_BOARD_SKIN_TEMPLATE WHERE BST_KEYNO = BSP_INSERT_KEYNO) as BSP_INSERT_FORM
		FROM B_BOARD_SKIN_PACKAGE
		WHERE BSP_KEYNO = #{BSP_KEYNO}
	</select>
	
	
	<insert id="BSP_insert"> 
		INSERT INTO B_BOARD_SKIN_PACKAGE
		(
			BSP_TITLE,
			BSP_LIST_KEYNO,
			BSP_DETAIL_KEYNO,
			BSP_INSERT_KEYNO,
			BSP_REGNM,
			BSP_REGDT
		)VALUES(
			#{BSP_TITLE},
			#{BSP_LIST_KEYNO},
			#{BSP_DETAIL_KEYNO},
			#{BSP_INSERT_KEYNO},
			#{BSP_REGNM},
			SYSDATE()
		)
	</insert>
	
	
	<update id="BSP_update">
	UPDATE B_BOARD_SKIN_PACKAGE
	SET 
		BSP_TITLE = #{BSP_TITLE},
		BSP_LIST_KEYNO = #{BSP_LIST_KEYNO},
		BSP_DETAIL_KEYNO = #{BSP_DETAIL_KEYNO},
		BSP_INSERT_KEYNO = #{BSP_INSERT_KEYNO}
	WHERE BSP_KEYNO  = #{BSP_KEYNO}
	</update>

	<update id="BSP_delete">
	UPDATE B_BOARD_SKIN_PACKAGE
	SET 
		BSP_DELETE = 'Y'
	WHERE BSP_KEYNO  = #{BSP_KEYNO}
	</update>
	
	<select id="BSP_list" resultType="BoardSkin">
 		SELECT *
 		FROM B_BOARD_SKIN_PACKAGE
 		WHERE BSP_DELETE = 'N'
	</select>
	
	<select id="boardSkinForm" resultType="String">
 		SELECT BST_FORM 
		FROM B_BOARD_SKIN_TEMPLATE 
		WHERE BST_KEYNO = #{BST_KEYNO}
	</select>
	
</mapper>     
